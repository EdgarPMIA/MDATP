
<!-- This is a combined device control file, it needs to be split into two xmls, groups and policies
###################################################################################################################
Create Groups these are your block and allow media types and devices
###################################################################################################################
-->

<Groups>
    <!--Group 1: Block Any removable storage, CD/DVD, or WPD device -->
	<Group Id="{9b28fae8-72f7-4267-a1a5-685f747a7146}">
	    <!-- ./Vendor/MSFT/Defender/Configuration/DeviceControl/PolicyGroups/%7b9b28fae8-72f7-4267-a1a5-685f747a7146%7d/GroupData -->
		<MatchType>MatchAny</MatchType>
		<DescriptorIdList>
			<PrimaryId>RemovableMediaDevices</PrimaryId>
			<PrimaryId>CdRomDevices</PrimaryId>
			<PrimaryId>WpdDevices</PrimaryId>
		</DescriptorIdList>
	</Group>

    <!-- Group 2: Allow Approved USBs based on device properties -->
	<Group Id="{65fa649a-a111-4912-9294-fb6337a25038}">
		<MatchType>MatchAny</MatchType>
		<DescriptorIdList>
            <!--This is your allow hardware list, add entries for allowed devices here based on the DescriptorIdList property schema-->
			<InstancePathId>USBSTOR\DISK&amp;VEN_KINGSTON&amp;PROD_DATATRAVELER_2.0&amp;REV_PMAP\C860008861D7EF41CA13157C&amp;*</InstancePathId>
            <InstancePathId>SCSI\DISK&amp;VEN_G-TECH&amp;PROD_ARMORATD\6&amp;2054B149&amp;0&amp;*</InstancePathId>
            <InstancePathId>USBSTOR\DISK&amp;VEN_IMATION&amp;PROD_IRONKEY_PUBLIC&amp;REV_0303\17166275&amp;*</InstancePathId>
            <InstancePathId>USBSTOR\DISK&amp;VEN_IMATION&amp;PROD_IRONKEY_SECURE&amp;REV_0303\17166275&amp;*</InstancePathId>
            <InstancePathId>USBSTOR\DISK&amp;VEN_STT&amp;PROD_EXPRESS_RC8&amp;REV_0\92134223000000000006&amp;*</InstancePathId>
            <InstancePathId>USBSTOR\DISK&amp;VEN_SANDISK&amp;PROD_CRUZER_GLIDE&amp;REV_1.26\200542560211B4208B1B&amp;*</InstancePathId>
		</DescriptorIdList>
	</Group>
</Groups>

<!--Examples of the "DescriptorIdList" property values for various drives
NOTE: Removable storage device control errors are logged and can be accessed by running "%programfiles%\Windows Defender\MpCmdRun.exe" -GetFiles
NOTE: Any & character has to be escaped in XML by replacing the & with the following text:  &amp;
NOTE: The last digit of the InstancePathId is the slot number, which may change when you plug in a device,
especially when you have multiple USBs connected, therefore a wildcard should be used. For example:

USBSTOR\DISK&amp;VEN_KINGSTON&amp;PROD_DATATRAVELER_2.0&amp;REV_PMAP\C860008861D7EF41CA13157C&amp;*

###################################################################################################################
Kingston DataTraveler 2.0 USB Device
###################################################################################################################

PrimaryId - RemovableMediaDevices
InstancePathId - USBSTOR\DISK&amp;VEN_KINGSTON&amp;PROD_DATATRAVELER_2.0&amp;REV_PMAP\C860008861D7EF41CA13157C&amp;0
DeviceId - USBSTOR\DISK&amp;VEN_KINGSTON&amp;PROD_DATATRAVELER_2.0&amp;REV_PMAP
HardwareId - USBSTOR\DiskKingstonDataTraveler_2.0PMAP
FriendlyNameId - Kingston DataTraveler 2.0 USB Device
BusId - USBSTOR
SerialNumberId - C860008861D7EF41CA13157C&amp;0
VID_PID - "VID_0930&amp;PID_6545" (This is the "Parent" property in device manager)

###################################################################################################################
G-TECH ArmorATD SCSI Disk Device
###################################################################################################################

PrimaryId - RemovableMediaDevices
InstancePathId - SCSI\DISK&amp;VEN_G-TECH&amp;PROD_ARMORATD\6&amp;2054B149&amp;0&amp;000000
DeviceId - SCSI\DISK&amp;VEN_G-TECH&amp;PROD_ARMORATD
HardwareId - SCSI\DiskG-TECH__ArmorATD________1024
FriendlyNameId - G-TECH ArmorATD SCSI Disk Device
BusId - SCSI
SerialNumberId - 6&amp;2054B149&amp;0&amp;000000
VID_PID - VID_4791&amp;PID_2057 (This is the "Parent" property in device manager)

###################################################################################################################
Imation IronKey USB Device - Public/Private
###################################################################################################################

PrimaryId - RemovableMediaDevices
InstancePathId - USBSTOR\DISK&amp;VEN_IMATION&amp;PROD_IRONKEY_PUBLIC&amp;REV_0303\17166275&amp;0
DeviceId - USBSTOR\DISK&amp;VEN_IMATION&amp;PROD_IRONKEY_PUBLIC&amp;REV_0303
HardwareId - USBSTOR\DiskImation_IronKey_Public__0303
FriendlyNameId - Imation IronKey Public USB Device
BusId - USBSTOR
SerialNumberId - 17166275&amp;0
VID_PID - VID_0718&amp;PID_0688 (This is the "Parent" property in device manager)

PrimaryId - RemovableMediaDevices
InstancePathId - USBSTOR\DISK&amp;VEN_IMATION&amp;PROD_IRONKEY_SECURE&amp;REV_0303\17166275&amp;1
DeviceId - USBSTOR\DISK&amp;VEN_IMATION&amp;PROD_IRONKEY_SECURE&amp;REV_0303
HardwareId - USBSTOR\DiskImation_IronKey_Secure__0303
FriendlyNameId - Imation IronKey Secure USB Device
BusId - USBSTOR
SerialNumberId - 17166275&amp;1
VID_PID - VID_0718&amp;PID_0688 (This is the "Parent" property in device manager)

###################################################################################################################
Super Talent USB 3.0 Express RC8
###################################################################################################################

PrimaryId - RemovableMediaDevices
InstancePathId - USBSTOR\DISK&amp;VEN_STT&amp;PROD_EXPRESS_RC8&amp;REV_0\92134223000000000006&amp;0
DeviceId - USBSTOR\DISK&amp;VEN_STT&amp;PROD_EXPRESS_RC8&amp;REV_0
HardwareId - USBSTOR\DiskSTT_____EXPRESS_RC8_____0___
FriendlyNameId - STT EXPRESS RC8 USB Device
BusId - USBSTOR
SerialNumberId - 92134223000000000006&amp;0
VID_PID - USB\VID_1B8F&amp;PID_0307\92134223000000000006 (This is the "Parent" property in device manager)

###################################################################################################################
SanDisk Cruzer Glide USB Device
###################################################################################################################

PrimaryId - RemovableMediaDevices
InstancePathId - USBSTOR\DISK&amp;VEN_SANDISK&amp;PROD_CRUZER_GLIDE&amp;REV_1.26\200542560211B4208B1B&amp;0
DeviceId - USBSTOR\DISK&amp;VEN_SANDISK&amp;PROD_CRUZER_GLIDE&amp;REV_1.26
HardwareId - USBSTOR\DiskSanDisk_Cruzer_Glide____1.26
FriendlyNameId - SanDisk Cruzer Glide USB Device
BusId - USBSTOR
SerialNumberId - 200542560211B4208B1B&amp;0
VID_PID - VID_0781&amp;PID_5575 (This is the "Parent" property in device manager)

###################################################################################################################
SanDisk Cruzer Glide USB Device - This one will not be placed in allow list so should not work
###################################################################################################################

PrimaryId - RemovableMediaDevices
InstancePathId - USBSTOR\DISK&amp;VEN_SANDISK&amp;PROD_CRUZER_GLIDE&amp;REV_1.27\2005174013111E218717&amp;0
DeviceId - USBSTOR\DISK&amp;VEN_SANDISK&amp;PROD_CRUZER_GLIDE&amp;REV_1.27
HardwareId - USBSTOR\DiskSanDisk_Cruzer_Glide____1.27
FriendlyNameId - SanDisk Cruzer Glide USB Device
BusId - USBSTOR
SerialNumberId - 2005174013111E218717&amp;0
VID_PID - VID_0781&amp;PID_5575 (This is the "Parent" property in device manager)

-->

<!--
###################################################################################################################
Create policies, these are your access control policies and apply to the device control groups
###################################################################################################################
-->

<PolicyRules>
    <!-- Policy 1: Allow/Audit write and execute access to allowed USBs -->
    <PolicyRule Id="{36ae1037-a639-4cff-946b-b36c53089a4c}">
        <!-- ./Vendor/MSFT/Defender/Configuration/DeviceControl/PolicyRules/%7b36ae1037-a639-4cff-946b-b36c53089a4c%7d/RuleData -->
        <Name>Audit write and execute access to approved USBs</Name>
        <IncludedIdList>
            <GroupId>{65fa649a-a111-4912-9294-fb6337a25038}</GroupId>
        </IncludedIdList>
        <ExcludedIdList></ExcludedIdList>
        <Entry Id="{a0bcff88-b8e4-4f48-92be-16c36adac930}">
            <Type>Allow</Type>
            <Options>0</Options>
            <AccessMask>63</AccessMask>
            <Sid>S-1-5-21-4160335514-3859470241-1414062150-3603</Sid><!-- AD user group objectSid attribute value, place users with an ETP in this -->
            <ComputerSid>S-1-5-21-4160335514-3859470241-1414062150-360</ComputerSid><!-- AD computer group objectSid attribute value, place authorized users computers in this -->
        </Entry>
        <Entry Id="{4a17df0b-d89d-430b-9cbe-8e0721192281}">
            <Type>AuditAllowed</Type>
            <Options>2</Options>
            <AccessMask>54</AccessMask>
        </Entry>
    </PolicyRule>
    
    <!--Policy 2: Block read, write, and execute access, and audit but allow approved USBs-->
    <PolicyRule Id="{c544a991-5786-4402-949e-a032cb790d0e}">
        <!-- ./Vendor/MSFT/Defender/Configuration/DeviceControl/PolicyRules/%7bc544a991-5786-4402-949e-a032cb790d0e%7d/RuleData -->
        <Name>"USB removable storage devices"</Name> <!-- This is the string that shows up in your toast notification -->
        <IncludedIdList>
            <GroupId>{9b28fae8-72f7-4267-a1a5-685f747a7146}</GroupId><!-- This must match the "Group 1: Block Any removable storage and CD/DVD" in the group xml -->
        </IncludedIdList>
        <ExcludedIdList>
            <GroupId>{65fa649a-a111-4912-9294-fb6337a25038}</GroupId><!-- This must match the "Group 2: Allow Approved USBs based on device properties" in the group xml -->
        </ExcludedIdList>
        <Entry Id="{75ff3d3a-e1dd-4fa0-8cdb-72e32a8c5462}">
            <Type>Deny</Type>
            <Options>0</Options>
            <AccessMask>7</AccessMask> <!-- BitMask value of 1: Read, 2: Write, 4: Execute -->
        </Entry>
        <Entry Id="{07e22eac-8b01-4778-a567-a8fa6ce18a0c}">
            <Type>AuditDenied</Type>
            <Options>3</Options>
            <AccessMask>7</AccessMask> <!-- BitMask value of 1: Read, 2: Write, 4: Execute -->
        </Entry>
    </PolicyRule>
</PolicyRules>
